<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	layout:decorate="~{layout/layout}">
<body layout:fragment="content">
	<div class="text-left">
		<h1 class="display-5">AP帳號列表</h1>
	</div>
	<div class="container-fluid px-3 py-3">
		<form name="accountForm" method="post">
			<div class="form-group row justify-content-center">
				<label for="departmentId"
					class="col-auto col-form-label font-weight-bold">部門別/服務群</label>
				<div class="col-lg-4">
					<select name="departmentId" id="departmentId" class="form-control">
						<option value="">請選擇</option>
						<option th:each="department : ${departmentList}"
							th:value="${department.departmentId}"
							th:text="${department.departmentName}"></option>
					</select>
				</div>
			</div>
			<div class="row mt-2">
				<div class="col-lg-12 text-center">
					<button type="button" class="btn btn-primary--c"
						onclick="findAPAccountList()">查詢</button>
				</div>
			</div>
		</form>
		<div class="card-body-step0-step1-step2-step3">
			<div class="table--c my-4">
				<table class="table--accountList"></table>
			</div>
		</div>

	</div>
	<script th:inline="javascript">
        $(function() {
        	$('.table--c').on('click', '.btn--editBtn', function() {
        		let arg = $(this).data('json');
        		
        		formSubmit([[@{apAccountSetting}]], arg);
        	});
        });

        function findAPAccountList(obj) {
        	obj = obj || $('form').serialize()+'&action=QUERY';

        	callAjax([[@{findAPAccount}]], obj, composeTable);
        }

        function composeTable(data) {
        	$('.table--accountList').bootstrapTable('destroy');

        	$('.table--accountList').bootstrapTable({
        		columns: [ //欄位設定
        			{field: 'createDate', title: '建立時間', class: 'w20', align: 'center'},
        			{field: 'departmentName', title: '部門別', class: 'w40', halign: 'center'},
        			{field: 'sourceId', title: 'SOURCE ID', class: 'w20', halign: 'center'},
        			{field: 'enabled', title: '帳號狀態', class: 'w10', align: 'center', formatter: statusFormatter},
        			{field: '', title: '', class: 'w10', align: 'center', formatter: buttonFormatter}
        		],
        		// classes: 'table table-striped table-bordered table-dark',
        		sidePagination: 'server',
        		data: data.result,//資料
        		pagination: true, //是否要分頁
        		pageNumber: data.number, //初始化加載第一頁
        		pageSize: data.size, //一頁顯示幾筆
        		pageList: [10, 20, 50, 100, 'All'], //一頁顯示幾筆的選項
        		totalRows: data.total,
        		// search : true, //查詢
        		checkboxHeader: false,
        		sortName: data.name,
        		sortOrder: data.order,
        		/*onClickRow: function(row, $element, field) {
        			console.log('row: ', row);

        		},*/
        		onSort: function(name, order) {
        			// console.log('name: ' + name + ', order: ' + order);

        			// findAPAccountList({'name': name, 'order': order});
        		},
        		onPageChange: function(number, size) {
        			// console.log('number: ' + number + ', size: ' + size);

        			size = isNaN(size) ? this.totalRows : size;

        			findAPAccountList({'number': number, 'size': size});
        		},
        		onLoadError: function(status, jqXHR) {
        			// console.log('status: ' + status + ', jqXHR: ' + jqXHR);
        		}
        	});
        }

        function statusFormatter(value, row, index) {
        	let elmI = '<i class="' + (row.enabled === 'Y' ? 'bg-success' : 'bg-danger') + '"></i>';

        	let elmSpan = '<span>' + (row.enabled === 'Y' ? '啟動' : '停用') + '</span>';

        	return '<span class="badge badge-dot">' + elmI + elmSpan + '</span>'
        }

        function buttonFormatter(value, row, index) {
        	let editBtn = '<button type="button" class="btn btn-primary--c btn-sm btn--editBtn" data-json=' + JSON.stringify({'departmentId': row.departmentId, 'sourceId': row.sourceId}) + '>編輯</button>';

        	return editBtn;
        }
    </script>
</body>
</html>
